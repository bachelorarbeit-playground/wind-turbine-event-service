asyncapi: 2.0.0
info:
  title: Wind Generation Data Service
  version: "1.0.0"
  description: |
    Receive, store and process incoming live Wind Generation Data from wind turbines.
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  production:
    url: mqtt://test.mosquitto.org
    protocol: mqtt
    description: Test MQTT broker

channels:
  rawWindData:
    subscribe:
      operationId: onRawWindDataGenerated
      message:
        $ref: "#/components/messages/RawWindDataEvent"
  ingestionPipeline:
    publish:
      operationId: onProcessedDataIngested
      message:
        $ref: "#/components/messages/ProcessedDataEvent"
  anomalyDetection:
    publish:
      operationId: onAnomalyLogged
      message:
        $ref: "#/components/messages/AnomalyDataEvent"

components:
  messages:
    RawWindDataEvent:
      name: rawWindData
      title: Raw Wind Generation Data Event
      summary: |
        An event containing the raw data related to
        a certain amount of energy which was generated by a turbine in a period of time
      contentType: application/json
      payload:
        $ref: "#/components/schemas/rawWindDataPayload"
    ProcessedDataEvent:
      name: ProcessedDataEvent
      title: Processed Event Data ready for ML Ingestion
      summary: |
        An event containing the processed wind generation data which is published to a
        topic related to machine learning ingestion
      contentType: application/json
      payload:
        $ref: "#/components/schemas/processedDataPayload"
    AnomalyDataEvent:
      name: AnomalyDataEvent
      title: Anomaly Event Data ready for redirection to anomaly topic
      summary: |
        An event containing the data for an anomaly which occurred, ready to be sent to
        topic related to anomaly detection
      contentType: application/json
      payload:
        $ref: "#/components/schemas/anomalyDataPayload"

  schemas:
    rawWindDataPayload:
      type: object
      required:
        - "park_id"
        - "turbine_id"
        - "date"
        - "interval"
        - "value"
        - "availability"
        - "region"
        - "timezone"
      properties:
        park_id:
          type: string
          format: uuid
          minLength: 0
          maxLength: 36
          description: UUID of wind park the current turbine belongs to
        turbine_id:
          type: string
          format: uuid
          minLength: 0
          maxLength: 36
          description: UUID of the current turbine
        date:
          type: string
          format: date
          description: Date when energy was generated  (e.g. 11-03-2020)
        interval:
          type: integer
          description: Order of the interval of time in the day (values range from 1-24 for 1 hour intervals)
          minimum: 1
          maximum: 24
        timezone:
          type: string
          description: Timezone in which the turbine finds itself
        value:
          type: number
          description: Energy generated in the respective interval in MWH
          minimum: 0
        availability:
          type: integer
          description: Percentage of availability in given interval (0-100 integer)
          minimum: 0
          maximum: 100
        region:
          type: string
          pattern: Ber
          description: Name of the region in which the wind park is located

    processedDataPayload:
      type: object
      required:
        - "park_id"
        - "processing_timestamp"
        - "value"
      properties:
        park_id:
          type: string
          format: uuid
          description: UUID of wind park the current turbine belongs to
        timestamp:
          type: string
          format: date-time
          description: Start of time interval when energy was generated in UTC format
        processing_timestamp:
          type: string
          format: date-time
          description: Timestamp at which event was processed
        value:
          type: number
          description: Energy generated in the respective interval in KWH
          minimum: 0

    anomalyDataPayload:
      type: object
      required:
        - "park_id"
        - "processing_timestamp"
        - "value"
        - "availability"
      properties:
        park_id:
          type: string
          format: uuid
          description: UUID of wind park the current turbine belongs to
        timestamp:
          type: string
          format: date-time
          description: Start of time interval when energy was generated in UTC format
        processing_timestamp:
          type: string
          format: date-time
          description: Timestamp at which event was processed
        value:
          type: number
          description: Energy generated in the respective interval in KWH
        availability:
          type: number
          description: Percentage of availability in given interval
          minimum: 0
          maximum: 1
        region:
          type: string
          description: Name of the region in which the wind park is located
